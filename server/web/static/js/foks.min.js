(()=>{function teamTableUpdateHooks(){var needed;needed=0<document.querySelectorAll("div#teams-table .theirs").length,document.getElementById("teams-table-sep").style.display=needed?"block":"none";{let disabled=parseInt(document.getElementById("max-teams").innerHTML)<=document.querySelectorAll("div#teams-table button.unclaim-button").length;document.querySelectorAll("div#teams-table button.claim-button").forEach(function(butt){butt.disabled=disabled})}}function dismissToast(button){button=button.currentTarget.closest("div.toast");button&&(button.style.display="none")}function validateDomainPart(s){if(48<s.length)msg="too long";else{if(!s.match(/^-|-$|--/)&&s.match(/^[a-z0-9A-Z-]+$/))return null;msg="invalid"}return new Error(msg)}function setHostnameValidator(){let cannedName=document.getElementById("canned-name");cannedName&&attachDespam(cannedName)&&cannedName.addEventListener("input",function(){{var cn=cannedName.value;cannedName.value=cn.toLowerCase();let msg="";0!=cn.length&&(cn.length<3?msg="hostname too short":(cn=validateDomainPart(cn))&&(msg="hostname  "+cn.message)),cannedName.setCustomValidity(msg)}toggleVHostSubmit()})}function toggleVHostSubmit(){var byodName=document.getElementById("full-vanity-hostname"),cannedName=document.getElementById("canned-name"),submit=document.getElementById("vhost-submit"),toggle=document.getElementById("toggle-byod");byodName&&toggle&&submit&&cannedName&&(0<byodName.value.length&&toggle.checked||0<cannedName.value.length&&!toggle.checked?submit.disabled=!1:submit.disabled=!0)}function attachDespam(el){return!el.classList.contains("js-attached")&&(el.classList.add("js-attached"),1)}function setBYODValidator(){let byodName=document.getElementById("full-vanity-hostname");byodName&&attachDespam(byodName)&&byodName.addEventListener("input",function(){{var val=byodName.value,val=(byodName.value=val.toLowerCase(),val.split("."));let msg="";val.length<2?msg="No TLD found":val.length<3?msg="Hostname cannot be an apex domain; valid examples include 'sub.acme.com' and 'foks.us.myco.com'":6<val.length?msg="too many domain parts":val.pop().match(/^[a-z]{2,10}$/)?val.forEach(function(part){var err=validateDomainPart(part);err&&(msg="domain part '"+part+"': "+err.message)}):msg="invalid TLD",byodName.setCustomValidity(msg)}toggleVHostSubmit()})}function setDisplayWidgets(){document.querySelectorAll("div.collapsible").forEach(function(widget){var button=widget.querySelector("button.collapse-toggle");let span=widget.querySelector("span.collapse-toggle-img"),target=widget.querySelector("div.collapse-target");button&&span&&target&&attachDespam(button)&&button.addEventListener("click",function(){target.classList.contains("open")?(span.innerHTML="▷",target.classList.remove("open")):(span.innerHTML="▽",target.classList.add("open"))})});var widget=document.querySelector("div#sso");if(widget){var checkbox=widget.querySelector("input#toggle-sso");let target=widget.querySelector("div.collapse-target");checkbox&&target&&(checkbox.checked&&target.classList.add("open"),attachDespam(checkbox))&&checkbox.addEventListener("change",event=>{event.target.checked?target.classList.add("open"):target.classList.remove("open")})}}function setThemeToggle(){var themeToggle=document.getElementById("theme-toggle");themeToggle&&attachDespam(themeToggle)&&themeToggle.addEventListener("click",function(){var isDark;isDark=document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",isDark?"dark":"light")})}function setFormMachinery(){setHostnameValidator(),setBYODValidator();var el=document.getElementById("toggle-byod");if(el){let nm=document.getElementById("canned-input"),dm=document.getElementById("byod-input");function clear(el){el.querySelectorAll("input").forEach(function(inp){inp.validity.valid||(inp.value="",inp.setCustomValidity(""))})}function showCanned(){nm.classList.remove("hidden"),dm.classList.add("hidden"),clear(dm)}function showBYOD(){nm.classList.add("hidden"),dm.classList.remove("hidden"),clear(nm)}(el.hasAttribute("checked")||el.checked?showBYOD:showCanned)(),attachDespam(el)&&el.addEventListener("input",function(){toggleVHostSubmit(),(this.checked?showBYOD:showCanned)()})}el=document.querySelector("form#user-viewership");if(el){let sel=el.querySelector("select#mode"),but=el.querySelector("button#submit"),val=el.querySelector("input#current-val");function setBut(){but.disabled=sel.value===val.value}sel&&but&&val&&(setBut(),attachDespam(sel))&&sel.addEventListener("change",function(){setBut()})}toggleVHostSubmit()}var savedTheme,prefersDark;savedTheme=localStorage.getItem("theme"),prefersDark=window.matchMedia("(prefers-color-scheme: dark)").matches,"dark"===savedTheme||!savedTheme&&prefersDark?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),htmx.on("htmx:load",function(evt){(evt=evt.target).classList.contains("usage-row")&&"FORM"===evt.tagName?teamTableUpdateHooks():evt.classList.contains("toast")&&"DIV"===evt.tagName&&evt.querySelectorAll("button.dismiss-toast").forEach(function(butt){butt.onclick=dismissToast}),setFormMachinery(),setDisplayWidgets(),setThemeToggle()}),htmx.on("htmx:beforeSwap",function(evt){422!==evt.detail.xhr.status&&401!==evt.detail.xhr.status||(evt.detail.shouldSwap=!0,evt.detail.isError=!1)}),htmx.on("htmx:configRequest",function(evt){var meta=document.querySelector('meta[name="csrf-token"]');meta&&(meta=meta.getAttribute("content"))&&(evt.detail.headers["X-CSRF-Token"]=meta)})})();
